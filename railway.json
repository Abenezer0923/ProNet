{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
        "builder": "NIXPACKS"
    },
    "deploy": {
        "startCommand": "npm run start",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
    },
    "services": {
        "pronet-postgres": {
            "image": "postgres:15",
            "env": {
                "POSTGRES_USER": "${{POSTGRES_USER}}",
                "POSTGRES_PASSWORD": "${{POSTGRES_PASSWORD}}",
                "POSTGRES_DB": "${{POSTGRES_DB}}"
            },
            "volumes": {
                "/var/lib/postgresql/data": "${{RAILWAY_VOLUME_MOUNT_PATH}}"
            }
        },
        "pronet-user-service": {
            "root": "services/user-service",
            "build": {
                "buildCommand": "npm install --legacy-peer-deps && npm run build"
            },
            "env": {
                "PORT": "3001",
                "DATABASE_URL": "${{pronet-postgres.DATABASE_URL}}",
                "JWT_SECRET": "${{JWT_SECRET}}",
                "RESEND_API_KEY": "${{RESEND_API_KEY}}",
                "CLOUDINARY_CLOUD_NAME": "${{CLOUDINARY_CLOUD_NAME}}",
                "CLOUDINARY_API_KEY": "${{CLOUDINARY_API_KEY}}",
                "CLOUDINARY_API_SECRET": "${{CLOUDINARY_API_SECRET}}",
                "FRONTEND_URL": "${{FRONTEND_URL}}"
            },
            "dependsOn": [
                "pronet-postgres"
            ]
        },
        "pronet-api-gateway": {
            "root": "services/api-gateway",
            "build": {
                "buildCommand": "npm install --legacy-peer-deps && npm run build"
            },
            "env": {
                "PORT": "3000",
                "USER_SERVICE_URL": "${{pronet-user-service.RAILWAY_PRIVATE_DOMAIN}}:3001",
                "JWT_SECRET": "${{JWT_SECRET}}"
            },
            "dependsOn": [
                "pronet-user-service"
            ]
        }
    }
}