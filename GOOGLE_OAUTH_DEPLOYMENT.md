# Google OAuth Deployment Guide - Vercel + Render

## üéØ Overview

This guide shows you how to deploy ProNet with Google OAuth working on:
- **Frontend**: Vercel
- **Backend**: Render
- **Google OAuth**: Configured for production

---

## üìã Prerequisites

- Google Cloud Project with OAuth credentials
- GitHub account
- Vercel account (free)
- Render account (free)

---

## Part 1: Configure Google OAuth for Production

### Step 1: Update Google Cloud Console

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Select your project
3. Navigate to **APIs & Services** > **Credentials**
4. Click on your OAuth 2.0 Client ID

### Step 2: Add Production Redirect URIs

Add these authorized redirect URIs:

**Local Development:**
```
http://localhost:3001/api/auth/google/callback
```

**Production (Render):**
```
https://pronet-user-service.onrender.com/api/auth/google/callback
```

**Note**: You'll update this with your actual Render URL after deployment.

### Step 3: Save Changes

Click **Save** in Google Cloud Console.

---

## Part 2: Deploy Backend to Render

### Step 1: Deploy Using Blueprint

1. Go to [render.com/dashboard](https://render.com/dashboard)
2. Click **"New"** ‚Üí **"Blueprint"** (NOT Web Service!)
3. Connect your GitHub repository: `Abenezer0923/ProNet`
4. Render will detect `render.yaml`
5. Click **"Apply"**

### Step 2: Wait for Deployment

This takes 10-15 minutes:
- PostgreSQL database (2-3 min)
- User Service (5-7 min)
- API Gateway (5-7 min)

### Step 3: Configure Google OAuth Environment Variables

After deployment completes:

1. Go to Render Dashboard
2. Click on **pronet-user-service**
3. Go to **Environment** tab
4. Add/Update these variables:

```
GOOGLE_CALLBACK_URL=https://pronet-user-service.onrender.com/api/auth/google/callback
FRONTEND_URL=https://your-app-name.vercel.app
```

**Note**: You'll update `FRONTEND_URL` after deploying to Vercel.

4. Click **"Save Changes"**
5. Service will automatically redeploy

### Step 4: Get Your Backend URLs

Copy these URLs from Render Dashboard:
- **User Service**: `https://pronet-user-service.onrender.com`
- **API Gateway**: `https://pronet-api-gateway.onrender.com`

---

## Part 3: Deploy Frontend to Vercel

### Step 1: Import Project

1. Go to [vercel.com/new](https://vercel.com/new)
2. Click **"Import Project"**
3. Import from GitHub: `Abenezer0923/ProNet`
4. Configure:
   - **Framework Preset**: Next.js
   - **Root Directory**: `frontend`
   - **Build Command**: `npm run build`
   - **Output Directory**: `.next`

### Step 2: Add Environment Variables

In Vercel project settings, add:

```
NEXT_PUBLIC_API_URL=https://pronet-api-gateway.onrender.com
NEXT_PUBLIC_WS_URL=https://pronet-user-service.onrender.com
```

### Step 3: Deploy

1. Click **"Deploy"**
2. Wait 2-3 minutes
3. Copy your Vercel URL: `https://your-app-name.vercel.app`

---

## Part 4: Final Configuration

### Step 1: Update Render with Vercel URL

1. Go back to Render Dashboard
2. Click on **pronet-user-service**
3. Go to **Environment** tab
4. Update:
   ```
   FRONTEND_URL=https://your-app-name.vercel.app
   ```
5. Click **"Save Changes"**

### Step 2: Update Google Cloud Console

1. Go back to Google Cloud Console
2. Update authorized redirect URIs with your actual Render URL:
   ```
   https://pronet-user-service.onrender.com/api/auth/google/callback
   ```
3. Add authorized JavaScript origins:
   ```
   https://your-app-name.vercel.app
   ```
4. Click **"Save"**

### Step 3: Update API Gateway Environment

1. In Render Dashboard, click on **pronet-api-gateway**
2. Go to **Environment** tab
3. Verify:
   ```
   USER_SERVICE_URL=https://pronet-user-service.onrender.com
   ```

---

## Part 5: Test the Deployment

### Step 1: Visit Your App

Go to: `https://your-app-name.vercel.app`

### Step 2: Test Google OAuth

1. Click **"Continue with Google"**
2. You should be redirected to Google's consent screen
3. Authorize the app
4. You should be redirected back and logged in

### Step 3: Verify Everything Works

- [ ] Landing page loads
- [ ] Google OAuth button works
- [ ] Can sign up with Google
- [ ] Can sign up with email
- [ ] Can login
- [ ] Dashboard loads
- [ ] Profile works
- [ ] Communities work

---

## üîß Environment Variables Summary

### Render - User Service

```env
PORT=3001
DATABASE_HOST=<from-render-postgres>
DATABASE_PORT=<from-render-postgres>
DATABASE_USER=<from-render-postgres>
DATABASE_PASSWORD=<from-render-postgres>
DATABASE_NAME=<from-render-postgres>
JWT_SECRET=<auto-generated>
CLOUDINARY_CLOUD_NAME=dgl4cpuik
CLOUDINARY_API_KEY=637454513411741
CLOUDINARY_API_SECRET=7JHtL4bTAYqwq7RaQM60Ocf43fw
GOOGLE_CLIENT_ID=1075769500266-h4qk4amb9du8pl4tnk3beht03dak9sju.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GOOGLE_CALLBACK_URL=https://pronet-user-service.onrender.com/api/auth/google/callback
FRONTEND_URL=https://your-app-name.vercel.app
```

### Render - API Gateway

```env
PORT=3000
USER_SERVICE_URL=https://pronet-user-service.onrender.com
JWT_SECRET=<same-as-user-service>
```

### Vercel - Frontend

```env
NEXT_PUBLIC_API_URL=https://pronet-api-gateway.onrender.com
NEXT_PUBLIC_WS_URL=https://pronet-user-service.onrender.com
```

### Google Cloud Console

**Authorized redirect URIs:**
```
http://localhost:3001/api/auth/google/callback
https://pronet-user-service.onrender.com/api/auth/google/callback
```

**Authorized JavaScript origins:**
```
http://localhost:3000
https://your-app-name.vercel.app
```

---

## üêõ Troubleshooting

### Issue: "Redirect URI mismatch"

**Cause**: Google OAuth redirect URI doesn't match

**Solution**:
1. Check Google Cloud Console redirect URIs
2. Verify they exactly match: `https://pronet-user-service.onrender.com/api/auth/google/callback`
3. No trailing slashes
4. Must be HTTPS in production

### Issue: "CORS error"

**Cause**: Frontend can't connect to backend

**Solution**:
1. Check `NEXT_PUBLIC_API_URL` in Vercel
2. Verify API Gateway is running on Render
3. Check API Gateway logs for CORS configuration

### Issue: "Cannot connect to database"

**Cause**: Database not ready or wrong credentials

**Solution**:
1. Wait 5 minutes for database to provision
2. Check Render logs for user-service
3. Verify database environment variables

### Issue: "Google OAuth works locally but not in production"

**Cause**: Environment variables not updated

**Solution**:
1. Verify `GOOGLE_CALLBACK_URL` in Render matches Google Console
2. Verify `FRONTEND_URL` in Render matches your Vercel URL
3. Check Google Console has production URLs added
4. Redeploy services after updating environment variables

### Issue: "Service sleeps/slow first request"

**Cause**: Render free tier spins down after inactivity

**Solution**:
- First request takes 30-60 seconds (normal)
- Consider upgrading to paid tier for always-on
- Or use a service like UptimeRobot to ping your app

---

## üìä Deployment Checklist

### Google Cloud Console
- [ ] OAuth 2.0 Client ID created
- [ ] Redirect URIs added (local + production)
- [ ] JavaScript origins added
- [ ] OAuth consent screen configured

### Render Backend
- [ ] Blueprint deployment completed
- [ ] PostgreSQL database running
- [ ] User Service deployed and running
- [ ] API Gateway deployed and running
- [ ] All environment variables configured
- [ ] Google OAuth variables set
- [ ] Services showing "Live" status

### Vercel Frontend
- [ ] Project imported from GitHub
- [ ] Root directory set to `frontend`
- [ ] Environment variables added
- [ ] Deployment successful
- [ ] App accessible via URL

### Final Configuration
- [ ] Render FRONTEND_URL updated with Vercel URL
- [ ] Google Console updated with production URLs
- [ ] Tested Google OAuth flow
- [ ] Tested email registration
- [ ] Tested login
- [ ] All features working

---

## üöÄ Quick Deploy Commands

### Update Render Environment Variables

```bash
# Install Render CLI (optional)
npm install -g @render/cli

# Or update via Dashboard:
# 1. Go to service
# 2. Click "Environment"
# 3. Update variables
# 4. Click "Save Changes"
```

### Redeploy Vercel

```bash
# Install Vercel CLI
npm install -g vercel

# Deploy
cd frontend
vercel --prod
```

### Check Deployment Status

```bash
# Render services
curl https://pronet-api-gateway.onrender.com/health
curl https://pronet-user-service.onrender.com/health

# Vercel frontend
curl https://your-app-name.vercel.app
```

---

## üîí Security Notes

1. **Never commit secrets to Git**
   - Use environment variables
   - Add `.env` to `.gitignore`

2. **Use HTTPS in production**
   - Vercel provides HTTPS automatically
   - Render provides HTTPS automatically

3. **Rotate secrets regularly**
   - Change JWT_SECRET periodically
   - Rotate Google OAuth credentials if compromised

4. **Monitor logs**
   - Check Render logs for errors
   - Check Vercel logs for frontend issues

---

## üìà Performance Tips

1. **Enable caching**
   - Vercel automatically caches static assets
   - Configure API caching if needed

2. **Optimize images**
   - Use Next.js Image component
   - Cloudinary handles image optimization

3. **Monitor response times**
   - Render free tier may be slower
   - Consider upgrading for better performance

---

## üí∞ Cost Breakdown

### Free Tier (Current Setup)
- **Vercel**: FREE (100GB bandwidth, unlimited requests)
- **Render**: FREE (750 hours/month, sleeps after inactivity)
- **Google OAuth**: FREE
- **Total**: $0/month ‚úÖ

### Paid Tier (Recommended for Production)
- **Vercel Pro**: $20/month (better performance, team features)
- **Render Starter**: $7/month per service (always-on, better resources)
- **Total**: ~$34/month for production-ready setup

---

## üéâ Success!

If everything is working:
1. Your app is live on Vercel
2. Backend is running on Render
3. Google OAuth is working
4. Users can sign up and login

**Share your app**: `https://your-app-name.vercel.app`

---

## üìû Support

- **Issues**: [GitHub Issues](https://github.com/Abenezer0923/ProNet/issues)
- **Render Docs**: [render.com/docs](https://render.com/docs)
- **Vercel Docs**: [vercel.com/docs](https://vercel.com/docs)
- **Google OAuth**: [developers.google.com/identity](https://developers.google.com/identity)

---

## üîÑ Updating Your Deployment

### Update Backend (Render)

1. Push changes to GitHub
2. Render auto-deploys from main branch
3. Or manually trigger deploy in Render Dashboard

### Update Frontend (Vercel)

1. Push changes to GitHub
2. Vercel auto-deploys from main branch
3. Or manually trigger deploy in Vercel Dashboard

### Update Environment Variables

1. Update in Render/Vercel Dashboard
2. Services will automatically redeploy
3. Changes take effect immediately

---

**Ready to deploy? Follow the steps above and you'll have a production-ready app with Google OAuth in 30 minutes!** üöÄ
